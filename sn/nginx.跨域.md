#nginx的反向代理实现跨域

##名词解释

跨域：指的是浏览器不能执行其他网站的代码。这是有浏览器的同源性导致的。

浏览器的同源性：域名、协议、端口相同。

浏览器在执行js脚本时会检查这个脚本属于哪个页面，如果不是同源页面就不会执行。

浏览器的同源策略是为了反之某些黑客的不发行为。如：如果允许跨域，那么某个黑客可以制作一个类似某个银行的网页表单，用户输入数据提交后黑客就能接收到此表单，而设置了同源性时，黑客就不能接收到该表单的内容。

目前随着RESTFUL的流行，很多应用提供http/https接口的API，仅仅通过xml/json主要是json的数据格式向外面提供服务，实现开放架构。如微博、微信、天气预报和openstack等网站和应用都是RESTFUL接口。

web页面也在向单页面发展，越来越多的web应用现在设置这样的架构“

- 静态的单个web页面
- ajax调用
- restful服务

我们本可以借助各个网站的API做出很多精彩的App，但浏览器执行js的跨域性，称为了这类开放框架的拦路虎。

##目前常用的跨域方法

1. 使用iframe访问另一域（如天气的插件），然后在从另一个页面读取iframe的内容。jquery等有次封装。据说firefox等可能不支持读取另一个iframe的内容
2. 使用jsonp数据。使用script src 动态获得一段java代码，该代码是回调页面上的js函数。参数是json对象。此方法jquery也有封装。
3. 设置http头，Access-Control-Allow-Origin：*，但居所IE有些版本不支持此http头
4. 使用服务器代理。服务器写一个url处理的action，其参数是一个url。这个服务器会使用参数拼凑成一个url，使用httpclinet库执行url。然后把读取的数据内容再输出到http客户端。


##nginx反向代理实现跨域

**优点：**只需要更改nginx的配置项即可解决问题，支持所有的浏览器，支持session,不许要修改任何服务器端代码。并且不会影响服务器的性能。

**原理：**在nginx中配置多个前缀来转发http/http的请求多个真实的服务器即可。对浏览器来说，浏览器面对的服务器是这台nginx服务器，从而所有的域名、协议和端口都是相同的。这样，浏览器就将这些页面看做同源的，从而可以再服务器内js可以跨域调用所有这些服务器上的代码。

**方法：**

1. 匹配请求的页面url
2. 通过nginx的重写功能重定向（映射到）其他的服务器



